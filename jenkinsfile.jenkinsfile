pipeline {
    agent any
    stages {
        stage ('Source code') {
            steps{
                sh 'rm -Rf *'
                sh 'git clone  https://github.com/alilefe/terraform.git'
            }
        }
        stage('Init') {
            steps {
                sh 'echo Inicializando terraform...'
                sh 'pwd'
                dir("$WORKSPACE/terraform"){
              
                    azureCLI commands: [[exportVariablesString: '', script: 'az vm list']], principalCredentialId: 'azure_pruebas'
                    sh 'terraform init'
                    sh 'terraform plan -out test.out'
                    sh 'terraform apply -auto-approve -input=test.out'
                
                }
            }
        }
        
    }
}
